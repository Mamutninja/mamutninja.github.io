<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hello te butha ló</title>
  <link rel="icon" type="image/x-icon" href="images/beefalo.png">
  <script src="https://unpkg.com/lottie-web@5.10.2/build/player/lottie.min.js"></script>
  <style>
    #beefalo {
      width: 200px;
      cursor: pointer;
      display: block;
      margin: 0 auto;
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      outline: none;
      
    }
    #lottie-container {
      width: 150px;
      height: 150px;
      margin: 10px auto;
      position: absolute;
      pointer-events: none;
      display: none; /* kezdetben el van rejtve */
    }

    #love-counter-container {
      margin-top: 20px; /* távolság a többi tartalomtól */
      font-size: 24px;
      margin-left: -2px; /* balra tolja az egész containert */
    }
    #heart-icon {
      vertical-align: -1px;
      margin-right: 3px; /* távolság a szám és a szívecske között */
    }
    
    *:focus {
      outline: none;
    }
    
    /* no focus anywhere */ 
    html, body {
      user-select: none;
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
    }
    
  </style>
</head>
<body>
  <div style="text-align: center;">
    <h1>Üdvözölnek a beefalok.</h1>
    <p>~ Hana</p>
  </div>
  <div style="text-align: center;">
    <img id="beefalo" src="images/beefalo.png" alt="Beefalo" width="300" draggable="false" tabindex="-1">
  </div>
  <div id="love-counter-container" style="text-align: center; margin-left: -2px;">
    <img id="heart-icon" src="images/heart-icon.png" alt="Heart" width="40" style="vertical-align: -1px; margin-right: 3px;">
    <span id="love-counter">0</span>
  </div>
  <div id="lottie-container"></div>


  <canvas id="hit-test-canvas" style="display: none;"></canvas> 

  <script>
    const beefaloImg = document.getElementById('beefalo');
    const canvas = document.getElementById('hit-test-canvas');
    const ctx = canvas.getContext('2d');
    const beefalo = new Image();
    beefalo.src = 'images/beefalo.png';
  
    beefalo.onload = function () {
      canvas.width = beefaloImg.width;
      canvas.height = beefaloImg.height;
      ctx.drawImage(beefalo, 0, 0, beefaloImg.width, beefaloImg.height);
    };
    
    let containerCount = 0;
    let loveGiven = 0;
    
    // Lottie animáció inicializálása, autoplay kikapcsolva
    const animacio = lottie.loadAnimation({
      container: document.getElementById('lottie-container'),
      renderer: 'svg',
      loop: false,
      autoplay: false,
      path: 'images/heartlottie.json'
    });

    beefaloImg.addEventListener('click', function (event) {
      // ne jelenjen meg a 'text caret'
      event.preventDefault(); // ne kapjon fókuszt semmi
      document.activeElement.blur(); // vegye el a fókuszt a jelenlegi elemtől
      
      const rect = beefaloImg.getBoundingClientRect();
      const xBeefalo = event.clientX - rect.left;
      const yBeefalo = event.clientY - rect.top;
  
      const pixel = ctx.getImageData(xBeefalo, yBeefalo, 1, 1).data;
      const alpha = pixel[3]; // 0 = teljesen átlátszó, 255 = teljesen látható
  
      if (alpha < 10) return; // ha átlátszó részre kattintottunk, semmit ne csináljon
      
      containerCount ++;
      loveGiven ++;
      document.getElementById('love-counter').textContent = loveGiven;
      const container = document.getElementById('lottie-container');
      
      const xLottie = event.clientX;
      const yLottie = event.clientY;
  
      // új div létrehozása
      const newContainer = document.createElement('div');
      newContainer.style.position = 'absolute';
      newContainer.style.left = `${xLottie - 75}px`;  // középre igazítás
      newContainer.style.top = `${yLottie - 140}px`;
      newContainer.style.width = '150px';
      newContainer.style.height = '150px';
      newContainer.style.pointerEvents = 'none';
      newContainer.id = `lottie-heart-${containerCount}`;
  
      document.body.appendChild(newContainer);
  
      const anim = lottie.loadAnimation({
        container: newContainer,
        renderer: 'svg',
        loop: false,
        autoplay: true,
        path: 'images/heartlottie.json'
    });


    document.addEventListener('click', function (event) {
      // Ez mindent defókuszál és eltünteti a caret-et
      event.preventDefault();
      if (document.activeElement) document.activeElement.blur();
      window.getSelection()?.removeAllRanges();
    }, true); // a 'true' itt fontos, hogy capturing fázisban fusson
          

    anim.addEventListener('complete', function () {
      newContainer.remove(); // automatikusan törli magát
    });
  });
  </script>
</body>
</html>

