<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Hello te butha ló</title>
  <link rel="icon" type="image/x-icon" href="/images/beefalo.png">
  <script src="https://unpkg.com/lottie-web@5.10.2/build/player/lottie.min.js"></script>
  <style>
    #beefalo {
      width: 200px;
      cursor: pointer;
      display: block;
      margin: 0 auto;
    }
    #lottie-container {
      width: 150px;
      height: 150px;
      margin: 10px auto;
      position: absolute;
      pointer-events: none;
      display: none; /* kezdetben el van rejtve */
    }
  </style>
</head>
<body>
  <div style="text-align: center;">
    <h1>Üdvözölnek a beefalok.</h1>
    <p>~ Hana</p>
  </div>
  <div style="text-align: center;">
    <img id="beefalo" src="images/beefalo.png" alt="Beefalo" width="300">
  </div>
  <div id="lottie-container"></div>


  <canvas id="hit-test-canvas" style="display: none;"></canvas> 

  <script>
    const beefaloImg = document.getElementById('beefalo');
    const canvas = document.getElementById('hit-test-canvas');
    const ctx = canvas.getContext('2d');
    const beefalo = new Image();
    beefalo.src = 'images/beefalo.png';
  
    beefalo.onload = function () {
      canvas.width = beefaloImg.width;
      canvas.height = beefaloImg.height;
      ctx.drawImage(beefalo, 0, 0, beefaloImg.width, beefaloImg.height);
    };
    
    let clickCount = 0;
    let containerCount = 0;
    
    // Lottie animáció inicializálása, autoplay kikapcsolva
    const animacio = lottie.loadAnimation({
      container: document.getElementById('lottie-container'),
      renderer: 'svg',
      loop: false,
      autoplay: false,
      path: 'images/heartlottie.json'
    });

    beefaloImg.addEventListener('click', function (event) {
      const rect = beefaloImg.getBoundingClientRect();
      const xBeefalo = event.clientX - rect.left;
      const yBeefalo = event.clientY - rect.top;
  
      const pixel = ctx.getImageData(xBeefalo, yBeefalo, 1, 1).data;
      const alpha = pixel[3]; // 0 = teljesen átlátszó, 255 = teljesen látható
  
      if (alpha < 10) return; // ha átlátszó részre kattintottunk, semmit ne csináljon
      
      clickCount ++;
      if (clickCount >= 20) return; // ha már megy ÉS 20-nál többet kattintottak, ne induljon újra
      containerCount ++;
      clickCount = 0;
      const container = document.getElementById('lottie-container');
      
      const xLottie = event.clientX;
      const yLottie = event.clientY;
  
      // új div létrehozása
      const newContainer = document.createElement('div');
      newContainer.style.position = 'absolute';
      newContainer.style.left = `${xLottie - 75}px`;  // középre igazítás
      newContainer.style.top = `${yLottie - 150}px`;
      newContainer.style.width = '150px';
      newContainer.style.height = '150px';
      newContainer.style.pointerEvents = 'none';
      newContainer.id = `lottie-heart-${containerCount}`;
  
      document.body.appendChild(newContainer);
  
      const anim = lottie.loadAnimation({
        container: newContainer,
        renderer: 'svg',
        loop: false,
        autoplay: true,
        path: 'images/heartlottie.json'
      });

    anim.addEventListener('complete', function () {
      newContainer.remove(); // automatikusan törli magát
    });
  });
  </script>
</body>
</html>

